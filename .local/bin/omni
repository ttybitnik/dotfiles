#!/usr/bin/env bash

# Update software on a variety of OS and managers.
#   Thanks to @branneman for sharing
#   these functions idea.

# Exit immediately if any command fails
set -e

# Check if the manager is installed
# and run the appropriate command.
run() {
  printf "\n>> %s \n\n" "$1"
  $1
}

run_if_exists() {
  if [ -x "$(command -v "$1")" ]; then
    run "$2"
  fi
}

# Prompt for sudo password only once
sudo true

### Distros
# Arch
run_if_exists "pacman" "sudo pacman -Syu"

# Debian
run_if_exists "apt" "sudo apt update"
run_if_exists "apt" "sudo apt upgrade -y"

# Fedora
run_if_exists "dnf" "sudo dnf update -y"

# FreeBSD
run_if_exists "pkg" "sudo pkg update"
run_if_exists "pkg" "sudo pkg upgrade -y"

# Slackware
run_if_exists "slackpkg" "sudo slackpkg update"
run_if_exists "slackpkg" "sudo slackpkg upgrade-all"
run_if_exists "sbocheck" "sudo sbocheck"
run_if_exists "sbocheck" "sudo sboupgrade --all"

# MacOS
run_if_exists "brew" "brew update"
run_if_exists "brew" "brew upgrade"

# Windows
run_if_exists "winget" "winget upgrade --all"

### Package managers
# Flatpak
run_if_exists "flatpak" "flatpak update -y"

# Python
run_if_exists "pip" "pip install --upgrade pip"
run_if_exists "pip" "pip list --outdated | awk '{print $1}' | xargs -n1 pip install -U"
