#!/usr/bin/env bash

# Tmux default session wrapper for terminal 02.

# OPT(podman): a=all s=size w=watch
podman_ps='podman stats --format "table {{if gt (len .Name) 20}}'
podman_ps+='{{truncate .Name 20}}+{{else}}{{.Name}}{{end}}\t{{.AVGCPU}}'
podman_ps+='\t{{.MemUsage}}\t{{.MemPerc}}"'

# Preamble for calling the script in a non-verbose fashion
tmux split-window
# OPT(tmux): t=target-pane
tmux swap-pane -t 1

tmux rename-window @kairos
# OPT(tmux): n=window-name
tmux new-window -n @vertov
# OPT(tmux): n=window-name
tmux new-window -n @dijkstra
# OPT(tmux): n=window-name
tmux new-window -n @oikos
# OPT(tmux): t=target-pane
tmux select-window -t 1
tmux split-window
tmux select-layout main-horizontal-mirrored
# OPT(tmux): t=target-pane
tmux split-window -t 3
tmux split-window -t 4 -h
# OPT(tmux): t=target-pane
# OPT(journalctl): f=follow
tmux send-keys -t 2 'journalctl -f' C-m
# OPT(tmux): t=target-pane
# OPT(top): e=scale-task-mem c=cmdline-toggle o=sort-override s=secure-mode
tmux send-keys -t 3 'top -e M -c -o %MEM -s' C-m
# OPT(tmux): t=target-pane
# OPT(virt-top): c=connect
tmux send-keys -t 4 "$podman_ps" C-m
# OPT(tmux): t=target-pane
tmux send-keys -t 5 "virt-top -c qemu:///system" C-m
# OPT(tmux): t=target-pane L=left
tmux resize-pane -t 2 -L 16
# OPT(tmux): t=target-pane
tmux select-pane -t 1
